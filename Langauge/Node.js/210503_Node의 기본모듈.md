# 노드의 기본 모듈

- [노드의 기본 모듈](#노드의-기본-모듈)
  - [`global` - 전역 객체](#global---전역-객체)
  - [`util` - 유틸리티](#util---유틸리티)
  - [이벤트](#이벤트)
  - [버퍼](#버퍼)
  - [스트림](#스트림)
  - [파일 시스템](#파일-시스템)
  - [경로](#경로)
  - [네트워크](#네트워크)
  - [HTTP와 HTTPS](#http와-https)
  - [URL 과 쿼리 문자열](#url-과-쿼리-문자열)
  - [ChildProcess - 자식 프로세스](#childprocess---자식-프로세스)
  - [Cluster](#cluster)
  - [예제](#예제)
    - [TCP 를 이용한 채팅 예제](#tcp-를-이용한-채팅-예제)
    - [모듈 종류 정리](#모듈-종류-정리)

해당 포스트에서는 노드가 제공하는 기본 모듈을 살펴봅니다. 노드에 포함된 모듈을 *기본 모듈* 이라고 부르고, 추가 설치가 필요한 모듈은 *확장 모듈* 이라고 합니다.

## `global` - 전역 객체

*전역 객체* `global` 는 **모든 스코프에서 접근 가능할 수 있는 객체**를 말합니다.

client javascript 에서는 `window` 가 전역 객체입니다. 노드에서 전역 객체는 `global` 이라는 이름으로 존재합니다. `console.log()`, `require()`, `setTimeout()` 등의 함수를 포함합니다. 편의상 `global` 은 생략할 수 있습니다.

`global` 객체에는 아래와 같은 변수들이 있습니다.

| 타입 | 이름         | 기능                                      | 참고                                                                      |
| ---- | ------------ | ----------------------------------------- | ------------------------------------------------------------------------- |
| var  | `__filename` | 현재 실행된 파일 위치                     |                                                                           |
| var  | `__dirname`  | 현재 실행된 디렉터리                      |                                                                           |
| obj  | `process`    | 실행된 노드 프로세스 정보를 담고있는 객체 | OSType, 실행 시간, 메모리 사용률, 워킹 디렉토리 등 포함. 이벤트 사용 가능 |
|      |              |

``` js
  console.log(__finename)
  // fileName : C:\Users\user\OneDrive\바탕 화면\practice\github\node-execution\node.js
  console.log(__dirname)
  // C:\Users\user\OneDrive\바탕 화면\practice\github\node-execution

  // process 객체
  process.execPath  // C:\Program Files\nodejs\node.exe
  process.cwd()     // C:\Users\user\OneDrive\바탕 화면\practice\github\node-execution
  process.env       // 중략
                    // 운영 체제의 환경 변수 process.env.PATH 로 접근
                    // DB 접근 정보, id, pw 등의 변수들은 환경변수에 저장합니다.
  process.version   // v14.16.1
  process.versions  // 중략
  process.arch      // x64
  process.platform  // win32
  process.memoryUsage()   // V8 의 res, heapTotal, heapUsed, external, arrayBuffers
  process.uptime()  // 0.0498826
  process.exit()
  process.on('exit', () => console.log('Bye')) // 프로세스가 종료될 때 exit 이벤트 발생
```

``` js
  // process 객체의 event 사용법
  // try-catch 문을 사용하지 않은 코드에서 에러를 출력하며 프로세스가 종료됩니다.
  // uncaughtException 이벤트 리스너를 등록하면 예상치 못한 예외 처리가 가능합니다.
  process.on('uncaughtException', err => {
      console.error('Exception! :: ', err)
  })

  setTimeout(() => {
      console.log('code execute...')
  }, 500)

  noneExsistentFunction() // 존재하지 않는 함수

  console.log('not execute...') // 실행되지 않음
```
  > ![execution](./images/210503_processUncaughtException.JPG)

``` js
  process.stdin.resume()
  process.stdin.setEncoding('utf-8')

  process.stdin.on('data', chunk => {
      process.stdout.write('data: ' + chunk)
  })
  process.stdin.on('end', () => { // 종료이벤트 (window 에서는 발생X)
      process.stdout.write('end')
  })
```

> ![helloWorld](./images/helloworld.JPG)

``` js
  process.argv.forEach((val, idx, arr) => {
      console.log(val, idx, arr)
  })

  // $ node node.js one two=three four

  // node 명령어로부터 공백으로 구분된 모든 명령어(one, two=three, four)가
  // process.argv 에 저장됨
```

``` js
  process.nextTick(() => {
      console.log('2 - is nextTick')
  })
  console.log('1')

  // 1
  // 2 - is nextTick
  // nextTick 의 콜백 함수는 바로 실행하지 않고 이벤트 큐에 등록합니다. 싱글 스레드가 현재 작업을 완료하고 다음이벤트를 처리할 수 있는때가 되면 콜백함수를 차례로 실행합니다. 비동기적으로 사용하는 setTimeout() 나 다른 I/O 함수 보다 훨씬 더 빠르게 동작합니다.
```

## `util` - 유틸리티

*유틸리티 모듈* 은 `require('util')` 로 불러와 사용합니다.

``` js
  const util = require('util')

  util.format('%s is %d', 'Today', 210511) // 'Today is 210511'
  util.types.isRegExp(/regExp/) // true
  util.types.isDate(new Date()) // true
```

| placeholder (%) |        |
| --------------- | ------ |
| `%s`            | String |
| `%d`            | Number |
| `%j`            | JSON   |
| `%%`            | %      |

## 이벤트

노드는 많은 객체가 이벤트를 발생시킬 수 있습니다. `require('events')` 로 불러옵니다. 

웹 서버에 새로운 요청이 들어오거나, 파일읽기가 완료되었을 때 등 일 때이벤트가 발생하는데, 발생하는 이벤트는 모두 `events.EventEmitter` 의 객체이며, `require('events').EventEmitter` 로 접근합니다.

*이벤트 발생*은 `emit` 이라는 단어를 사용하며, *이벤트 발생 함수*를 listener 라고 부릅니다. EventEmitter 객체에서 에러가 발생하면 `error` 이벤트가 발생합니다. `error` 이벤트에 listener 가 등록된 경우 listener 를 실행하고, 없으면 스택 트레이스를 출력하고 앱을 종료합니다.

``` js
  const server = require('http')

  server.createServer(function(req,resp) {
      resp.writeHead(200, { 'Content-Type': 'text/plain' })
      resp.end('Hello World\n')
  })
    .listen(3000, 'localhost')
    .on('connection', stream => {
        console.log('서버에 연결되었습니다.')
    })
```

* 객체에 **이벤트를 추가**
  * `emitter.addEventListener(event, listener)` 또는 `emitter.on(event, listener)` 를 사용 
  * `emitter` 는 `EventEmitter` 의 객체여야함
  * 매개변수
    * `event` { string } 이벤트 이름
    * `listener` { function } 이벤트가 발생했을 때 실행할 함수
  * 새로운 listener 가 추가될 때마다 `newListener` 이벤트가 발생합니다.

``` js
  // ...
  .once('connection', stream => {
    // 최초 한번만 실행되고, listener 배열에서 제거됩니다.
    console.log('첫 번째 접속')
  })
    // 지정한 이벤트에서 전달한 listener 를 제거합니다.
  .removeListener('connection', () => console.log('BYE!'))
    // 전달한 모든 listener를 제거합니다.
  .removeAllListeners(['connection'], () => console.log('BYE!'))
```

## 버퍼

## 스트림

## 파일 시스템

## 경로

## 네트워크

## HTTP와 HTTPS

## URL 과 쿼리 문자열

## ChildProcess - 자식 프로세스

## Cluster

## 예제

### TCP 를 이용한 채팅 예제

### 모듈 종류 정리

| 모듈명               | 설명                                                       |
| -------------------- | ---------------------------------------------------------- |
| Process              | 프로세스에 대한 정보를 담고있는 전역 객체                  |
| Utilities            | 타입 검사, 포매팅 등의 유틸리티 함수를 제공                |
| Events               | 이벤트 관련 함수 제공                                      |
| Buffers              | 바이너리 데이터의 옥텟 스트림(octet stream) 을 다루는 모듈 |
| Streams              | 스트림을 다루기 위한 추상 인터페이스                       |
| Crypto               | 암호화에 대한 함수 제공                                    |
| TLS/SSL              | 공개키/개인키 기반인 TLS/SSL 에 대한 함수 제공             |
| File System          | 파일을 다루는 함수                                         |
| Path                 | 파일의 경로를 다루는 함수 제공                             |
| Net                  | 비동기 네트워크 통신기능 제공                              |
| UDP/Datagram Sockets | UDP 의 데이터그램 소캣(Datagram Socket) 통신기능 제공      |
| DNS                  | 도메인 네임서버를 다루는 함수 제공                         |
| HTTP                 | HTTP 서버와 클라이언트 기능 제공                           |
| HTTPS                | HTTPS 서버와 클라이언트 기능 제공                          |
| URL                  | URL 을 다루는 함수 제공                                    |
| Query Strings        | URL 의 쿼리 문자열을 다루는 함수 제공                      |
| Redline              | 스트림에서 라인 단위로 읽는 기능 제공                      |
| Vm                   | 자바스크립트를 실행하는 기능 제공                          |
| Child Processes      | 자식 프로세스 생성과 관련된 함수 제공                      |
| Assert               | 유닛 테스트를 위한 단언문 제공                             |
| TTY                  | 터미널이나 콘솔 관련 기능 제공                             |
| Zlib                 | zlib 압축 함수 제공                                        |
| OS                   | 운영체제에 대한 정보를 제공하는 함수                       |
| Cluster              | 여러 노드 프로세스를 실행하는 클러스터 기능 제공           |
